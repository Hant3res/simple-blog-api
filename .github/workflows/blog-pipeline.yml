name: üöÄ Blog API Pipeline

on:
  push:
    branches: [main]

env:
  DOTNET_VERSION: '8.0.x'
  PROJECT_PATH: 'src/SimpleBlog.API'
  TEST_PATH: 'tests/SimpleBlog.API.Tests'

jobs:
  test:
    name: üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    runs-on: ubuntu-latest

    steps:
    - name: üí¨ –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–¥
      uses: actions/checkout@v4

    - name: üí¨ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ env.DOTNET_VERSION }}

    - name: üí¨ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      run: dotnet restore

    - name: üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
      run: dotnet build ${{ env.PROJECT_PATH }} --verbosity normal

    - name: üß™ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
      run: |
        echo "=== –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í ==="
        cd tests/SimpleBlog.API.Tests
        dotnet test --verbosity detailed --logger "console;verbosity=detailed"
        
    - name: üìä –°–æ–∑–¥–∞–µ–º –æ—Ç—á–µ—Ç
      if: always()
      run: |
        echo "=== –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò ==="
        echo "–ü—Ä–æ–µ–∫—Ç: Simple Blog API"
        echo ".NET Version: ${{ env.DOTNET_VERSION }}"
        echo "–í–µ—Ç–∫–∞: ${{ github.ref }}"
        echo "–ö–æ–º–º–∏—Ç: ${{ github.sha }}"
        echo "–í—Ä–µ–º—è: $(date)"
        echo "=========================="
